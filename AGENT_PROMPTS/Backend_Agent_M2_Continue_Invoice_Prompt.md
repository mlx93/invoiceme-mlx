# Backend Agent M2 - Continue with Invoice CRUD

Continue M2 implementation by implementing Invoice CRUD vertical slices following the same pattern as Customer CRUD: create `invoices/createinvoice/` (CreateInvoiceCommand with line items array, CreateInvoiceHandler with @Transactional, CreateInvoiceValidator ensuring ≥1 line item, CreateInvoiceController), `invoices/getinvoice/` (GetInvoiceQuery, GetInvoiceHandler returning InvoiceDetailResponse with line items and payments, GetInvoiceController), `invoices/listinvoices/` (ListInvoicesQuery with filters for status/customer/date range, ListInvoicesHandler returning Page<InvoiceSummaryResponse>, ListInvoicesController), `invoices/updateinvoice/` (UpdateInvoiceCommand, UpdateInvoiceHandler with business rules for Draft vs Sent status, UpdateInvoiceController), `invoices/markassent/` (MarkAsSentCommand, MarkAsSentHandler that calls invoice.markAsSent() and publishes InvoiceSentEvent, MarkAsSentController), and `invoices/cancelinvoice/` (CancelInvoiceCommand, CancelInvoiceHandler with validation, CancelInvoiceController). Use existing InvoiceRepository methods, include MapStruct mappers, publish domain events via DomainEventPublisher after transaction commit, and add all endpoints to the consolidated InvoiceController.java following the same pattern as CustomerController. After Invoice CRUD is complete, proceed to Payment CRUD vertical slices (recordPayment, get, list) to complete the core Customer → Invoice → Payment E2E flow.

